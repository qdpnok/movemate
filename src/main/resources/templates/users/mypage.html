<!DOCTYPE html>
<html
        xmlns:th="http://www.thymeleaf.org"
        xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
        layout:decorate="~{/layout/main}"
>
<head>
    <meta charset="UTF-8" />
    <title>my page</title>
</head>
<body>
<div layout:fragment="content">
    <div id="mypage-container">
        <div id="mypage">
            <h1>ë§ˆì´í˜ì´ì§€</h1>
            <div id="my-info">
                <div id="my-profile">
                    <img th:src="${userInfo.profileImageUrl} != null ? @{'/files/'+${userInfo.profileImageUrl}} : @{'/images/profile.png'}"
                         alt="í”„ë¡œí•„" class="img-round-small">
                    <div id="profile">
                        <p>ì´ë¦„ : <span th:text="${userInfo.name}"></span></p>
                        <p>ì•„ì´ë”” : <span th:text="${userInfo.userId}"></span></p>
                        <p>íœ´ëŒ€í°ë²ˆí˜¸ : <span th:text="${userInfo.phoneNo}"></span></p>
                        <p>ì„±ë³„ : <span th:text="${userInfo.gender}"></span></p>
                        <p>ë‚˜ì´ : <span th:text="${userInfo.age}"></span></p>
                    </div>
                </div>
                <div id="my-button-filed">
                    <div id="my-button">
                        <button class="mypage-button btn-mypost" th:onclick="|location.href='@{/posts/my_post}'|">ë‚´ê°€ ì“´ ê¸€ ë³´ê¸°</button>
                        <button class="mypage-button btn-edit-myinfo" th:onclick="|location.href='@{/users/edit}'|">íšŒì›ì •ë³´ìˆ˜ì •</button>
                        <button type="button" id="delete-button" class="btn-danger mypage-button" >íšŒì›íƒˆí‡´</button>
                    </div>
                    <form th:action="@{/users/{no}/delete(no=${userInfo.userNo})}" method="post" id="delete-form" style="display: none;"></form>
                </div>

                <div id="my-match">
                    <h2 class="sub-title">ë‚˜ì˜ ë§¤ì¹­ ë‚´ì—­</h2>

                    <div id="sport-type-choice-bar">
                        <button class="choice-button active" data-filter-group="sport" data-filter="running">ëŸ¬ë‹ ë©”ì´íŠ¸</button>
                        <button class="choice-button" data-filter-group="sport" data-filter="weight">ì›¨ì´íŠ¸ ë©”ì´íŠ¸</button>
                    </div>
                    <div id="crew-choice-bar" >
                        <button class="choice-button active" data-filter-group="type" data-filter="1v1">1:1 ë©”ì´íŠ¸</button>
                        <button class="choice-button" data-filter-group="type" data-filter="crew">ë©”ì´íŠ¸ í¬ë£¨</button>
                    </div>

<!--                    <div id="my-match-box">-->
<!--                        <button class="arrow-btn" id="prev-btn">&#8592;</button>-->

<!--                        <div id="my-match-slider-window">-->
<!--                            <div id="my-match-card-container">-->
<!--                                <div class="card" th:each="match : ${matchList}"-->
<!--                                th:data-sport-type="${match.sportType}"-->
<!--                                th:data-match-type="${match.mateType}">-->
<!--                                <img id="cardImg" th:src="${match.opponentProfileImageUrl} != null ? @{'/files/'+${match.opponentProfileImageUrl}} : @{'/images/profile.png'}"/>-->
<!--                                <p th:text="${match.opponentName}"></p>-->
<!--                                <p th:text="${match.region}"></p>-->
<!--                    -->
<!--                                <a id="mate-cut" href="#">ë©”ì´íŠ¸ í•´ì§€</a>-->
<!--                            </div>-->

<!--                            </div>-->
<!--                        </div>-->

<!--                        <button class="arrow-btn" id="next-btn">&#8594;</button>-->
<!--                    </div>-->
                </div>

            </div>

        </div>
    </div>
    <script>
        const deleteButton = document.getElementById('delete-button');
      const deleteForm = document.getElementById('delete-form');

      deleteButton.addEventListener('click', () => {
        // ì‚¬ìš©ìì—ê²Œ ìµœì¢…ì ìœ¼ë¡œ íƒˆí‡´ ì—¬ë¶€ë¥¼ í™•ì¸
        if (confirm('ì •ë§ë¡œ íšŒì›íƒˆí‡´ë¥¼ í•˜ì‹œê² ìŠµë‹ˆê¹Œ? ëª¨ë“  ì •ë³´ê°€ ì‚­ì œ ì²˜ë¦¬ë˜ë©° ë³µêµ¬ê°€ ë¶ˆê°€ëŠ¥í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.')) {
            // í™•ì¸ì„ ëˆ„ë¥´ë©´ ìˆ¨ê²¨ì§„ í¼ì„ ì „ì†¡ (POST ìš”ì²­)
            deleteForm.submit();
        }
    });
        document.addEventListener('DOMContentLoaded', () => {

            // --- ìš”ì†Œ ì„ íƒ ---
        const sliderContainer = document.getElementById('my-match-card-container');
        const allCards = sliderContainer.querySelectorAll('.card');
        const prevBtn = document.getElementById('prev-btn');
        const nextBtn = document.getElementById('next-btn');
        const filterButtons = document.querySelectorAll('.choice-button[data-filter-group]');

        // --- ìƒíƒœ ë³€ìˆ˜ ---
        let currentFilters = {
            sport: 'running', // HTML ë²„íŠ¼ì˜ data-filter ê°’ê³¼ ì¼ì¹˜
            type: '1v1'       // HTML ë²„íŠ¼ì˜ data-filter ê°’ê³¼ ì¼ì¹˜
        };
        let sliderIndex = 0;

        // --- í•¨ìˆ˜ ì •ì˜ ---

        /**
         * 1. í•„í„° ë²„íŠ¼ í´ë¦­ ì‹œ UI ì—…ë°ì´íŠ¸ ë° í•„í„° ìƒíƒœ ë³€ê²½ (handleFilterClick í•¨ìˆ˜ëŠ” ìˆ˜ì • ë¶ˆí•„ìš”)
         */
        function handleFilterClick(event) {
            const button = event.target;
            const group = button.dataset.filterGroup;
            const filterValue = button.dataset.filter;

            currentFilters[group] = filterValue;

            document.querySelectorAll(`.choice-button[data-filter-group="${group}"]`).forEach(btn => {
                btn.classList.remove('active');
            });

            button.classList.add('active');
            applyFiltersAndResetSlider();
        }

        /**
         * 2. í˜„ì¬ í•„í„°(currentFilters)ì— ë§ì¶° ì¹´ë“œë¥¼ ë³´ì—¬ì£¼ê±°ë‚˜ ìˆ¨ê¹€ (ğŸš¨ ì´ ë¶€ë¶„ì´ ê°€ì¥ ì¤‘ìš”í•©ë‹ˆë‹¤)
         */
        function applyFiltersAndResetSlider() {
            sliderIndex = 0;
            let visibleCardCount = 0;

            allCards.forEach(card => {
                // 1) ì¢…ëª© í•„í„°ë§: HTMLì˜ data-sport-type ì†ì„± ì‚¬ìš©
                const sportData = card.dataset.sportType.toLowerCase();
                const cardSportType = sportData.includes('ëŸ¬ë‹') || sportData.includes('running') ? 'running' : 
                      sportData.includes('ì›¨ì´íŠ¸') || sportData.includes('weight') ? 'weight' : 'unknown';

                // 2) ë§¤ì¹­ íƒ€ì… í•„í„°ë§: HTMLì˜ data-match-type ì†ì„± ì‚¬ìš© (MATE í…Œì´ë¸”ì˜ '1:1' ë˜ëŠ” 'GROUP' ê°’ì— ë”°ë¼)
                const cardMatchType = card.dataset.matchType.toLowerCase().includes('group') ? 'crew' : '1v1'; 

                // í•„í„° ì¡°ê±´ í™•ì¸
                const sportMatch = currentFilters.sport === cardSportType;
                const typeMatch = currentFilters.type === cardMatchType;

                // ë‘ í•„í„°ê°€ ëª¨ë‘ ì¼ì¹˜í•˜ë©´ ë³´ì—¬ì£¼ê³ , ì•„ë‹ˆë©´ ìˆ¨ê¹€
                if (sportMatch && typeMatch) {
                    card.style.display = 'block';
                    visibleCardCount++;
                } else {
                    card.style.display = 'none';
                }
            });

            // ìŠ¬ë¼ì´ë” ìœ„ì¹˜ ì—…ë°ì´íŠ¸ (ë¦¬ì…‹)
            updateSliderPosition(visibleCardCount);
        }

        /**
         * 3. ìŠ¬ë¼ì´ë” ìœ„ì¹˜(transform)ë¥¼ ì—…ë°ì´íŠ¸ (ìˆ˜ì • ë¶ˆí•„ìš”)
         */
        function updateSliderPosition(visibleCardCount) {
            if (visibleCardCount === 0 || allCards.length === 0) {
                sliderContainer.style.transform = 'translateX(0px)';
                prevBtn.disabled = true;
                nextBtn.disabled = true;
                return;
            }

            const cardWidth = 180;
            const cardGap = 30;
            const cardMoveDistance = cardWidth + cardGap;
            const moveX = sliderIndex * cardMoveDistance;
            sliderContainer.style.transform = `translateX(-${moveX}px)`;

            prevBtn.disabled = sliderIndex === 0;

            const visibleInWindow = 3;
            nextBtn.disabled = sliderIndex >= (visibleCardCount - visibleInWindow);
        }

        // --- ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì—°ê²° (ìˆ˜ì • ë¶ˆí•„ìš”) ---
        filterButtons.forEach(button => {
            button.addEventListener('click', handleFilterClick);
        });

        prevBtn.addEventListener('click', () => {
            if (sliderIndex > 0) {
                sliderIndex--;
                const visibleCount = sliderContainer.querySelectorAll('.card[style*="display: block"]').length;
                updateSliderPosition(visibleCount);
            }
        });

        nextBtn.addEventListener('click', () => {
            const visibleCount = sliderContainer.querySelectorAll('.card[style*="display: block"]').length;
            const visibleInWindow = 3;
            if (sliderIndex < (visibleCount - visibleInWindow)) {
                sliderIndex++;
                updateSliderPosition(visibleCount);
            }
        });

        // --- ì´ˆê¸° ì‹¤í–‰ ---
        applyFiltersAndResetSlider();
    });

    </script>
</div>
</body>
</html>
