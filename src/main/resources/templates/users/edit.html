<!DOCTYPE html>
<html
        xmlns:th="http://www.thymeleaf.org"
        xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
        layout:decorate="~{/layout/main}"
>
<head>
    <meta charset="UTF-8" />
    <title>my info edit</title>
</head>
<body>
<div layout:fragment="content">
  <div id="my-edit-container">
  <h1>íšŒì› ì •ë³´ ìˆ˜ì •</h1>
  <form
                th:action="@{/users/{userNo}/edit(userNo=${userInfo.userNo})}"
                th:object="${userInfo}"
                method="post"
                enctype="multipart/form-data"
        >
    <div id="user-info-edit-container">
      <div id="profile-img-edit">
        <div class="profile-left">
            <div class="avatar-box">
                <img id="avatarPreview" class="avatar img-round-small"
                     th:src="${userInfo.profileImageUrl} != null ?
                        @{'/files/'+${userInfo.profileImageUrl}} :
                        @{/images/profile.png}"
                     alt="í”„ë¡œí•„ ë¯¸ë¦¬ë³´ê¸°" />
            </div>
        </div>
      </div>
      <div id="profile-img-box">
          <p>í”„ë¡œí•„ ì‚¬ì§„</p>
          <div id="profile-img-button-box">
            <div id="profile-img-button">
              <label for="profileImageInput" >
              <button id="edit-profile-button" type="button">ì‚¬ì§„ ë³€ê²½</button>
              <input id="profileImageInput" type="file" name="profileImage" accept="image/*">
            </label>
            <label for="profileImageDelete">
              <button id="delete-profile-button" type="button">ì‚¬ì§„ ì‚­ì œ</button>
              <input id="profileImageDelete" name="is_image_delete_flag" type="hidden" value="false">
            </label>
            </div>
            <div class="hint">JPG/PNG/WebP ê¶Œì¥, 5MB ì´í•˜</div>
          </div>
        </div>
    </div>
      <table id="user-info-edit-table">
        <tr>
          <td>ì´ë¦„:</td>
          <td>
            <input type="text" class="input-txt" id="userNameInput" placeholder="ë³€ê²½í•  ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”." th:field="*{name}" required>
            <p class="signup-check"></p>
          </td>
        </tr>
        <tr>
          <td>ì•„ì´ë””:</td>
          <td>
            <input type="text" class="input-txt input-id" placeholder="ë³€ê²½í•  ì•„ì´ë””ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”." th:field="*{userId}" required>
            <p class="signup-check check-id"></p>
          </td>
        </tr>
        <tr>
          <td>ì´ë©”ì¼:</td>
          <td>
            <input type="text" class="input-txt input-email" placeholder="ë³€ê²½í•  ì´ë©”ì¼ì„ ì…ë ¥í•´ì£¼ì„¸ìš”." th:field="*{email}" required>
            <p class="signup-check check-email"></p>
          </td>
        </tr>
        <tr>
          <td>ë¹„ë°€ë²ˆí˜¸:</td>
          <td>
            <input type="password" class="input-txt input-pwd" placeholder="ë³€ê²½í•  ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”. (ë¹„ì›Œë‘ë©´ ê¸°ì¡´ ìœ ì§€)" name="password">
            <p class="signup-check check-pwd"></p>
          </td>
        </tr>
        <tr>
          <td>ë¹„ë°€ë²ˆí˜¸ í™•ì¸:</td>
          <td>
            <input type="password" class="input-txt input-pwd-check" placeholder="ë¹„ë°€ë²ˆí˜¸ë¥¼ í•œë²ˆ ë” ì…ë ¥í•´ì£¼ì„¸ìš”.">
            <p class="signup-check check-pwd-check"></p>
          </td>
        </tr>
        <tr>
          <td>íœ´ëŒ€í°ë²ˆí˜¸:</td>
          <td>
            <input type="text" class="input-txt input-tel" placeholder="ë³€ê²½í•  íœ´ëŒ€í°ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”." th:value="${userInfo.phoneNo}" th:field="*{phoneNo}" required>
            <p class="signup-check check-tel"></p>
          </td>
        </tr>
        <tr>
          <td>ì§€ì—­:</td>
          <td>
            <select name="region" id="select-region" class="region" th:field="*{region}">
              <option disabled hidden="hidden" value="">ë³€ê²½í•  ì§€ì—­ì„ ì„ íƒí•´ì£¼ì„¸ìš”</option>
            </select>
        <p class="signup-check"></p>
          </td>
        </tr>
        <tr>
          <td>ì„±ë³„:</td>
          <td><p id="edit-gender" th:text="${userInfo.gender}"></p></td>
        </tr>
        <tr>
          <td>ë‚˜ì´:</td>
          <td>
            <input type="text" id="userAgeInput" class="input-txt" placeholder="ë³€ê²½í•  ë‚˜ì´ë¥¼ ë§Œ ë‚˜ì´ë¡œ ì…ë ¥í•´ì£¼ì„¸ìš”." th:field="*{age}" required>
        <p class="signup-check"></p>
          </td>
        </tr>
        <tr>
          <td>ìš´ë™ì¢…ëª©:</td>
          <td>
            <div id="edit-sport-box">
                <div class="choice">
                    <input type="radio" name="sport" id="sportR" th:field="*{sportType}" value="ëŸ¬ë‹" />ëŸ¬ë‹
                </div>
                <div class="choice">
                    <input type="radio" name="sport" id="sportW" th:field="*{sportType}" value="ì›¨ì´íŠ¸" />ì›¨ì´íŠ¸
                </div>
                <div class="choice">
                    <input type="radio" name="sport" id="sportA" th:field="*{sportType}" value="ëª¨ë‘" />ëª¨ë‘ ì„ íƒ
                </div>
            </div>
            <div class="hint hint-edit-sport">ë³€ê²½í•  ìš´ë™ì¢…ëª©ì„ ì„ íƒí•´ì£¼ì„¸ìš”.</div>
          </td>
        </tr>
        <tr id="pace-box">
          <td>ëŸ¬ë‹í˜ì´ìŠ¤:</td>
          <td>
            <input type="text" class="input-txt" placeholder="MM:ss" th:field="*{paceDetail}"/>
            <p class="signup-check"></p>
          </td>
        </tr>
      </table>
    <div class="edit-button-box">
        <button type="submit" id="profile-update-button">íšŒì›ì •ë³´ìˆ˜ì •</button>
        <button type="button" id="withdraw-button" class="btn-danger" >íšŒì›íƒˆí‡´</button>
    </div>
    </form>
    <form th:action="@{/users/{no}/delete(no=${userInfo.userNo})}" method="post" id="delete-form" style="display: none;"></form>
  </div>
    <script th:inline="javascript">
      // ê°€ì… ì •ë³´ ê²€ì¦
      const idInput = document.querySelector(".input-id");
      const idCheck = document.querySelector(".check-id");

      const mailInput = document.querySelector(".input-email");
      const mailCheck = document.querySelector(".check-email");

      const pwInput = document.querySelector(".input-pwd");
      const pwCheck = document.querySelector(".check-pwd");

      const pwcInput = document.querySelector(".input-pwd-check");
      const pwcCheck = document.querySelector(".check-pwd-check");

      const telInput = document.querySelector(".input-tel");
      const telCheck = document.querySelector(".check-tel");

      const regionInput = document.querySelector(".region");
      const sportRunning = document.getElementById('sportR');
      const sportWeight = document.getElementById('sportW');
      const sportAll = document.getElementById('sportA');

      const nameInput = document.getElementById('userNameInput');
      const ageInput = document.getElementById('userAgeInput');

      const submitBtn = document.getElementById("profile-update-button");

      const deleteButton = document.getElementById('withdraw-button');
      const deleteForm = document.getElementById('delete-form');

      deleteButton.addEventListener('click', () => {
        // ì‚¬ìš©ìì—ê²Œ ìµœì¢…ì ìœ¼ë¡œ íƒˆí‡´ ì—¬ë¶€ë¥¼ í™•ì¸
        if (confirm('ì •ë§ë¡œ íšŒì›íƒˆí‡´ë¥¼ í•˜ì‹œê² ìŠµë‹ˆê¹Œ? ëª¨ë“  ì •ë³´ê°€ ì‚­ì œ ì²˜ë¦¬ë˜ë©° ë³µêµ¬ê°€ ë¶ˆê°€ëŠ¥í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.')) {
            // í™•ì¸ì„ ëˆ„ë¥´ë©´ ìˆ¨ê²¨ì§„ í¼ì„ ì „ì†¡ (POST ìš”ì²­)
            deleteForm.submit();
        }
    });
      

      const regexId = /^\w{8,20}$/;
      const regexMail =
      /^[0-9a-zA-Z]([-_\.]?[0-9a-zA-Z])*@[0-9a-zA-Z]([-_\.]?[0-9a-zA-Z])*\.[a-zA-Z]{2,3}$/;
      const regexPw = /^(?=.*[a-zA-Z])(?=.*[!@#$%^*+=-])(?=.*[0-9]).{8,}$/;
      const regexTel = /^0\d{1,2}-\d{3,4}-\d{4}$/;
        
        // ğŸ’¡ ëª¨ë“  í•„ë“œê°€ ìœ íš¨í•œ ìƒíƒœì¸ì§€ ì €ì¥í•˜ëŠ” í”Œë˜ê·¸ ê°ì²´ (ì´ˆê¸°ê°’ì€ trueë¡œ ì„¤ì •)
        const validationFlags = {
            id: true, // ì´ˆê¸°ì—ëŠ” ê¸°ì¡´ ì•„ì´ë””ê°€ ìœ íš¨í•˜ë‹¤ê³  ê°€ì •
            password: true, // ë¹„ë°€ë²ˆí˜¸ëŠ” ìˆ˜ì • ì‹œì—ë§Œ ê²€ì‚¬í•˜ë¯€ë¡œ trueë¡œ ê°€ì •
            passwordConfirm: true, // ë¹„ë°€ë²ˆí˜¸ëŠ” ìˆ˜ì • ì‹œì—ë§Œ ê²€ì‚¬í•˜ë¯€ë¡œ trueë¡œ ê°€ì •
            email: true, // ì´ˆê¸°ì—ëŠ” ê¸°ì¡´ ì´ë©”ì¼ì´ ìœ íš¨í•˜ë‹¤ê³  ê°€ì •
            phoneNo: true, // ì´ˆê¸°ì—ëŠ” ê¸°ì¡´ ë²ˆí˜¸ê°€ ìœ íš¨í•˜ë‹¤ê³  ê°€ì •
            sport: true, // ì´ˆê¸°ì—ëŠ” ì„ íƒë˜ì–´ ìˆë‹¤ê³  ê°€ì •
            region: true, // ì´ˆê¸°ì—ëŠ” ì„ íƒë˜ì–´ ìˆë‹¤ê³  ê°€ì •
            // ì°¸ê³ : ì´ë¦„ê³¼ ë‚˜ì´ëŠ” required ì†ì„±ìœ¼ë¡œ ì²˜ë¦¬í•˜ê³  validationFlagsì—ëŠ” í¬í•¨í•˜ì§€ ì•ŠìŒ
        };

// ì¡°ê±´ì‹ ê²€ì¦ - validate í•¨ìˆ˜ëŠ” ìœ íš¨ì„± ì—¬ë¶€ë§Œ ë°˜í™˜í•˜ë„ë¡ ìˆ˜ì •
const validate = (input, regex, el, okMsg, badMsg) => {
const v = input.value.trim();

 if (v === "") {
 el.textContent = "";
 el.classList.remove("valid");
 // requiredê°€ ì•„ë‹Œ í•„ë“œ(ex: ë¹„ë°€ë²ˆí˜¸)ê°€ ë¹„ì–´ìˆìœ¼ë©´ null ë°˜í™˜
 return input.hasAttribute('required') ? false : null;
 }
 if (regex.test(v)) {
 // ìœ íš¨í•  ê²½ìš° ë©”ì‹œì§€ í‘œì‹œ
 el.textContent = okMsg;
 el.style.color = "green";
 el.classList.add("valid");
 return true;
 } else {
 // ìœ íš¨í•˜ì§€ ì•Šì„ ê²½ìš° ë©”ì‹œì§€ í‘œì‹œ
 el.textContent = badMsg;
el.style.color = "red";
 el.classList.remove("valid");
 return false;
}};
        
        // ğŸ’¡ í•„ë“œë³„ ê²€ì¦ ë° í”Œë˜ê·¸ ì—…ë°ì´íŠ¸ í•¨ìˆ˜
        const validateField = (input, regex, el, okMsg, badMsg, flagName) => {
            const result = validate(input, regex, el, okMsg, badMsg);
            
            if (result === null) {
                // ë¹„ì–´ìˆëŠ” ê²½ìš° (ë¹„ë°€ë²ˆí˜¸ ê°™ì€ optional í•„ë“œ) -> ìœ íš¨ì„± í†µê³¼ë¡œ ê°„ì£¼
                validationFlags[flagName] = true;
            } else {
                validationFlags[flagName] = result;
            }
            updateSubmitBtn();
            return result;
        };

 const pwdCheck = () => {
const isPwEmpty = pwInput.value.trim() === "";
          const isPwcEmpty = pwcInput.value.trim() === "";

 if (isPwEmpty && isPwcEmpty) {
 pwcCheck.textContent = "";
pwcCheck.classList.remove("valid");
             validationFlags.passwordConfirm = true;
return true; // ë‘˜ ë‹¤ ë¹„ì–´ìˆìœ¼ë©´ ê¸°ì¡´ ìœ ì§€ë¡œ í†µê³¼
}
          
          if (isPwEmpty && !isPwcEmpty) {
            pwcCheck.textContent = "ìƒˆ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ë ¤ë©´ ë¹„ë°€ë²ˆí˜¸ë¥¼ ë¨¼ì € ì…ë ¥í•´ì£¼ì„¸ìš”.";
 pwcCheck.style.color = "red";
 pwcCheck.classList.remove("valid");
            validationFlags.passwordConfirm = false;
            return false;
          }

          if (pwInput.value === pwcInput.value) {
 pwcCheck.textContent = "ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•©ë‹ˆë‹¤."
 pwcCheck.style.color = "green";
 pwcCheck.classList.add("valid");
             validationFlags.passwordConfirm = true;
 return true;
 } else {
 pwcCheck.textContent = "ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.";
pwcCheck.style.color = "red";
 pwcCheck.classList.remove("valid");
             validationFlags.passwordConfirm = false;
return false;
 }
 }

 const sportCheck = () => {
          const checked = sportRunning.checked || sportWeight.checked || sportAll.checked
          validationFlags.sport = checked;
          // ë¼ë””ì˜¤ ë²„íŠ¼ì€ ì²´í¬ ìœ ë¬´ë§Œ í™•ì¸í•˜ê³  ë©”ì‹œì§€ëŠ” ë”°ë¡œ ì¶œë ¥í•˜ì§€ ì•ŠìŒ
 return checked
 }
        
        // ğŸ’¡ region ë³€ê²½ ì‹œ í”Œë˜ê·¸ ì—…ë°ì´íŠ¸
 const rCheck = () => {
            const selected = regionInput.value !== ""
            validationFlags.region = selected;
            // ì§€ì—­ ì„ íƒì€ ë©”ì‹œì§€ë¥¼ ë”°ë¡œ ì¶œë ¥í•˜ì§€ ì•ŠìŒ
            return selected
        }

 // submit í™œì„±í™”/ë¹„í™œì„±í™”
const updateSubmitBtn = () => {
            // ì´ë¦„, ë‚˜ì´ í•„ë“œ ê²€ì‚¬ (required ì†ì„±ë§Œ ì˜ì¡´)
            const nameValid = nameInput.value.trim() !== "";
            const ageValid = ageInput.value.trim() !== "";
            
            // ëª¨ë“  í”Œë˜ê·¸ì™€ required í•„ë“œê°€ ìœ íš¨í•´ì•¼ ë²„íŠ¼ í™œì„±í™”
 submitBtn.disabled = !(
                validationFlags.id && 
                validationFlags.password && 
                validationFlags.passwordConfirm && 
                validationFlags.email && 
                validationFlags.phoneNo && 
                validationFlags.sport && 
                validationFlags.region &&
                nameValid &&
                ageValid
            );
 };
        
        // ğŸ’¡ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ: ê° í•„ë“œ ì´ë²¤íŠ¸ì—ë§Œ validateFieldë¥¼ ì—°ê²°
        idInput.addEventListener("input", () => {
            validateField(idInput, regexId, idCheck, "ì‚¬ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤.", "ì•„ì´ë””ëŠ” ë°‘ì¤„ì„ í¬í•¨í•œ ì˜ìˆ«ì 8~20ì", 'id');
        });
        
        mailInput.addEventListener("input", () => {
            validateField(mailInput, regexMail, mailCheck, "ì‚¬ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤.", "ì˜¬ë°”ë¥¸ ì´ë©”ì¼ í˜•ì‹ìœ¼ë¡œ ì…ë ¥í•´ì£¼ì„¸ìš”.", 'email');
        });
        
        telInput.addEventListener("input", () => {
            validateField(telInput, regexTel, telCheck, "ì‚¬ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤.", " - ì„ í¬í•¨í•˜ì—¬ ì˜¬ë°”ë¥¸ íœ´ëŒ€í°ë²ˆí˜¸ í˜•ì‹ìœ¼ë¡œ ì…ë ¥í•´ì£¼ì„¸ìš”.", 'phoneNo');
        });
        
        // ë¹„ë°€ë²ˆí˜¸ ì…ë ¥ì´ ë³€ê²½ë˜ë©´ ë¹„ë°€ë²ˆí˜¸ ìœ íš¨ì„± ê²€ì‚¬ ë° í™•ì¸ ê²€ì‚¬
        pwInput.addEventListener("input", () => {
            const result = validateField(pwInput, regexPw, pwCheck, "ì•ˆì „í•œ ë¹„ë°€ë²ˆí˜¸ì…ë‹ˆë‹¤.", "ëŒ€/ì†Œë¬¸ì+ìˆ«ì+íŠ¹ìˆ˜ë¬¸ì í¬í•¨ 8ì ì´ìƒ", 'password');
            // ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì§€ ì•Šì•˜ì„ ê²½ìš°, ìœ íš¨ì„± ê²€ì‚¬ëŠ” trueë¥¼ ë°˜í™˜í•˜ì§€ë§Œ í™•ì¸ í•„ë“œ ê²€ì‚¬ëŠ” í•„ìš”í•¨
            if (result !== false) {
                pwdCheck();
            }
        });

        // ë¹„ë°€ë²ˆí˜¸ í™•ì¸ ì…ë ¥ì´ ë³€ê²½ë˜ë©´ í™•ì¸ ê²€ì‚¬
 pwcInput.addEventListener("input", () => {
            pwdCheck();
            updateSubmitBtn();
        });
        
        // ì´ë¦„, ë‚˜ì´ ì…ë ¥ ì‹œ ë²„íŠ¼ ìƒíƒœ ì—…ë°ì´íŠ¸
       

// ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
nameInput.addEventListener("input", updateSubmitBtn);
ageInput.addEventListener("input", updateSubmitBtn);
        

        // ğŸ’¡ ë¼ë””ì˜¤ ë²„íŠ¼/ì…€ë ‰íŠ¸ ë°•ìŠ¤ëŠ” í•„ë“œ ë©”ì‹œì§€ ì—†ì´ ë²„íŠ¼ í™œì„±í™”ë§Œ ë‹´ë‹¹ (ê¸°ì¡´ì˜ sportCheck, rCheck í•¨ìˆ˜ ë‚´ì—ì„œ í”Œë˜ê·¸ ì—…ë°ì´íŠ¸)
 sportRunning.addEventListener("click", () => { sportCheck(); updateSubmitBtn(); paceOpen(); });
 sportWeight.addEventListener("click", () => { sportCheck(); updateSubmitBtn(); paceClose(); });
 sportAll.addEventListener("click", () => { sportCheck(); updateSubmitBtn(); paceOpen(); });
 regionInput.addEventListener("change", () => { rCheck(); updateSubmitBtn(); });
        
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸° ìœ íš¨ì„± ê²€ì‚¬ ë° ë²„íŠ¼ ìƒíƒœ ì„¤ì •
        document.addEventListener("DOMContentLoaded", () => {
            // ì´ˆê¸°ê°’ì„ í”Œë˜ê·¸ì— ë°˜ì˜ (required í•„ë“œëŠ” HTML required ì†ì„±ì— ì˜ì¡´)
            validateField(idInput, regexId, idCheck, "ì‚¬ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤.", "ì•„ì´ë””ëŠ” ë°‘ì¤„ì„ í¬í•¨í•œ ì˜ìˆ«ì 8~20ì", 'id');
            validateField(mailInput, regexMail, mailCheck, "ì‚¬ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤.", "ì˜¬ë°”ë¥¸ ì´ë©”ì¼ í˜•ì‹ìœ¼ë¡œ ì…ë ¥í•´ì£¼ì„¸ìš”.", 'email');
            validateField(telInput, regexTel, telCheck, "ì‚¬ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤.", " - ì„ í¬í•¨í•˜ì—¬ ì˜¬ë°”ë¥¸ íœ´ëŒ€í°ë²ˆí˜¸ í˜•ì‹ìœ¼ë¡œ ì…ë ¥í•´ì£¼ì„¸ìš”.", 'phoneNo');
            
            // ë¹„ë°€ë²ˆí˜¸ í•„ë“œëŠ” ë¹„ì–´ìˆìœ¼ë¯€ë¡œ trueë¡œ ìœ ì§€.
            pwdCheck();
            
            // ë¼ë””ì˜¤ ë²„íŠ¼/ì§€ì—­ ì´ˆê¸° ì„ íƒ ìƒíƒœ ë°˜ì˜
            sportCheck();
            rCheck();
            
            // ìµœì¢… ë²„íŠ¼ ìƒíƒœ ì—…ë°ì´íŠ¸
            updateSubmitBtn();
        });

        // ìš´ë™ ì¢…ëª© ì„ íƒì— ë”°ë¼ í˜ì´ìŠ¤ ì…ë ¥ë€ ë³´ì´ê¸°
        const paceBox = document.getElementById("pace-box");

        const paceOpen = () => paceBox.style.display = 'table-row';
        const paceClose = () => paceBox.style.display = 'none';
        
        const currentSport = /*[[${userInfo.sportType}]]*/ 'ëŸ¬ë‹';
        if (currentSport === 'ëŸ¬ë‹' || currentSport === 'ëª¨ë‘') {
          paceOpen();
        } else {
          paceClose();
        }
      
        sportRunning.addEventListener("click", paceOpen);
        sportWeight.addEventListener("click", paceClose);
        sportAll.addEventListener("click", paceOpen);

      // ì§€ì—­ ì„ íƒ
      const regions = [
          "ê´‘ë•ë©´", "êµ¬ë£¡ë™", "êµ¬ì„±ë™", "ë‹¤ê°€ë™", "ëŒ€í¥ë™", "ë™ë©´", "ëª©ì²œì", "ë¬¸í™”ë™",
          "ë³‘ì²œë©´", "ë´‰ëª…ë™", "ë¶ë©´", "ì‚¬ì§ë™", "ì‚¼ë£¡ë™", "ì„±ë‚¨ë©´", "ì„±í™©ë™", "ìˆ˜ì‹ ë©´",
          "ì‹ ë°©ë™", "ì‹ ë¶€ë™", "ì•ˆì„œë™", "ì˜ì„±ë™", "ì˜¤ë£¡ë™", "ìš©ê³¡ë™", "ì›ì„±1ë™", "ì›ì„±2ë™",
          "ì›ì„±ë™", "ìœ ëŸ‰ë™", "ì²­ë‹¹ë™", "ì²­ìˆ˜ë™", "í’ì„¸ë©´", "ë‘ì •ë™", "ë°±ì„ë™", "ë¶€ëŒ€ë™",
          "ë¶€ì„±1ë™", "ë¶€ì„±2ë™", "ë¶ˆë‹¹ë™", "ì„±ê±°ì", "ì„±ì„±ë™", "ì„±ì •1ë™", "ì„±ì •2ë™", "ì„±ì •ë™",
          "ì„±í™˜ì", "ì‹ ë‹¹ë™", "ìŒìš©1ë™", "ìŒìš©2ë™", "ìŒìš©3ë™", "ìŒìš©ë™", "ì—…ì„±ë™", "ì™€ì´Œë™",
          "ì…ì¥ë©´", "ì§ì‚°ì", "ì°¨ì•”ë™"
        ];

        // ë“œë¡­ë‹¤ìš´ì— ìš”ì†Œ ìƒì„±
        const dropdown = document.querySelector("select");
        console.log(dropdown);

        regions.forEach((region) => {
          const newRegion = document.createElement("option");
          newRegion.value = region;
          newRegion.innerText = region;
          dropdown.appendChild(newRegion);
        });

        const regionValue = /*[[${userInfo.region}]]*/;
        const currentUserRegion = regionValue ? regionValue : '';

        if (currentUserRegion) {
          dropdown.value = currentUserRegion;
          console.log("í˜„ì¬ ì§€ì—­ ì„¤ì •ë¨: " + currentUserRegion);
        }

        /*<![CDATA[*/
        (function() {
          const input = document.getElementById('profileImageInput');
          const img = document.getElementById('avatarPreview');
          const label = document.getElementById('label-signup-profile');
          const button = document.getElementById('edit-profile-button');

          const deleteButton = document.getElementById('delete-profile-button'); 
          const isImageDeletedInput = document.getElementById('profileImageDelete');

          // ì„œë²„ì—ì„œ ë‚´ë ¤ì˜¨ ì›ë³¸ ì´ë¯¸ì§€ ê²½ë¡œ ì €ì¥(ì—†ìœ¼ë©´ ë¹ˆ ë¬¸ìì—´)
          const originalSrc = /*[[${userInfo != null}]]*/ false
                  ? /*[[${userInfo.profileImageUrl} != null ? @{/files/{file}(file=${userInfo.profileImageUrl})} : @{/images/profile.png}]]*/ ''
                  : '';

          let objectUrl = null;
          function revoke() {
            if (objectUrl) {
              URL.revokeObjectURL(objectUrl);
              objectUrl = null;
            }
          }

          // ì»¤ìŠ¤í…€ ë²„íŠ¼ì„ í´ë¦­í•˜ë©´ file ì—…ë¡œë“œ ì‹œì‘
          button?.addEventListener('click', () => {
            input.click()
            console.log("ë²„íŠ¼ í´ë¦­")
          });

          input?.addEventListener('change', function(e) {
            const file = e.target.files && e.target.files[0];
            if (!file) return;

            const okTypes = ['image/jpeg','image/png','image/webp','image/gif'];
            if (!okTypes.includes(file.type)) {
              alert('ì´ë¯¸ì§€ íŒŒì¼(JPG/PNG/WebP/GIF)ë§Œ ì—…ë¡œë“œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
              input.value = '';
              return;
            }
            if (file.size > 5 * 1024 * 1024) {
              alert('íŒŒì¼ ìš©ëŸ‰ì€ 5MB ì´í•˜ë§Œ ê°€ëŠ¥í•©ë‹ˆë‹¤.');
              input.value = '';
              return;
            }

            if(isImageDeletedInput) {
              isImageDeletedInput.value = 'false';
            }

            revoke();
            objectUrl = URL.createObjectURL(file);
            img.src = objectUrl;
          });

          deleteButton?.addEventListener('click', function() {
            if(isImageDeletedInput) {
              isImageDeletedInput.value = 'true';
            }

            input.value = '';

            img.src = /*[[@{/images/profile.png}]]*/;

            revoke();

            alert('í”„ë¡œí•„ ì‚¬ì§„ì´ ê¸°ë³¸ ì´ë¹„ì§€ë¡œ ë³€ê²½ë©ë‹ˆë‹¤.')
          })

          window.addEventListener('beforeunload', revoke);
        })();
        /*]]>*/
    </script>
</div>
</body>
</html>
